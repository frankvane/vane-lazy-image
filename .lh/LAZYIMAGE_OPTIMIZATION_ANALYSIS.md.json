{
    "sourceFile": "LAZYIMAGE_OPTIMIZATION_ANALYSIS.md",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 0,
            "patches": [
                {
                    "date": 1759226476268,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                }
            ],
            "date": 1759226476268,
            "name": "Commit-0",
            "content": "# LazyImage ç»„ä»¶ä¼˜åŒ–åˆ†ææŠ¥å‘Š\r\n\r\n## ğŸ“‹ æ¦‚è¿°\r\n\r\nåŸºäºå¯¹ LazyImage ç»„ä»¶çš„æ·±å…¥ä»£ç åˆ†æï¼Œæœ¬æŠ¥å‘Šè¯†åˆ«äº†å½“å‰å®ç°ä¸­çš„æ€§èƒ½ç“¶é¢ˆã€ä»£ç å†—ä½™å’Œä¼˜åŒ–æœºä¼šã€‚è¯¥ç»„ä»¶è™½ç„¶åŠŸèƒ½ä¸°å¯Œï¼ˆ89+ é¡¹åŠŸèƒ½ï¼‰ï¼Œä½†åœ¨æ¶æ„è®¾è®¡ã€æ€§èƒ½ä¼˜åŒ–å’Œä»£ç ç»´æŠ¤æ€§æ–¹é¢å­˜åœ¨æ˜¾è‘—çš„æ”¹è¿›ç©ºé—´ã€‚\r\n\r\n## ğŸ¯ æ ¸å¿ƒé—®é¢˜åˆ†æ\r\n\r\n### 1. æ¶æ„å¤æ‚åº¦é—®é¢˜\r\n\r\n#### 1.1 åŠŸèƒ½è¿‡åº¦è€¦åˆ\r\n\r\n- **é—®é¢˜**: å•ä¸ªç»„ä»¶æ‰¿æ‹…äº†è¿‡å¤šèŒè´£ï¼Œè¿åäº†å•ä¸€èŒè´£åŸåˆ™\r\n- **å½±å“**: ä»£ç éš¾ä»¥ç»´æŠ¤ã€æµ‹è¯•å›°éš¾ã€æ€§èƒ½ä¼˜åŒ–å—é™\r\n- **è¯æ®**:\r\n  - `LazyImage.tsx` 320 è¡Œä»£ç ï¼ŒåŒ…å«å›¾ç‰‡åŠ è½½ã€LQIP ç”Ÿæˆã€é”™è¯¯å¤„ç†ã€å†…å­˜ç®¡ç†ç­‰å¤šç§åŠŸèƒ½\r\n  - `useEnhancedInView.ts` 305 è¡Œï¼Œé›†æˆäº†æ»šåŠ¨ç®¡ç†ã€å†…å­˜ç®¡ç†ã€è·ç¦»è®¡ç®—ç­‰å¤šç§é€»è¾‘\r\n\r\n#### 1.2 Hook èŒè´£ä¸æ¸…\r\n\r\n- **é—®é¢˜**: å¤šä¸ª Hook ä¹‹é—´å­˜åœ¨åŠŸèƒ½é‡å å’Œä¾èµ–å…³ç³»å¤æ‚\r\n- **å½±å“**: çŠ¶æ€ç®¡ç†æ··ä¹±ã€å‰¯ä½œç”¨éš¾ä»¥è¿½è¸ª\r\n- **è¯æ®**:\r\n  - `useInView` å’Œ `useEnhancedInView` åŠŸèƒ½é‡å \r\n  - `useMemoryManager` å’Œ `useImageCache` éƒ½æ¶‰åŠç¼“å­˜ç®¡ç†\r\n  - `useLQIPGenerator` å’Œ `useImageLoader` éƒ½å¤„ç†å›¾ç‰‡åŠ è½½\r\n\r\n### 2. æ€§èƒ½ç“¶é¢ˆåˆ†æ\r\n\r\n#### 2.1 å†…å­˜ç®¡ç†æ•ˆç‡ä½ä¸‹\r\n\r\n```typescript\r\n// é—®é¢˜ä»£ç ç¤ºä¾‹ - useMemoryManager.ts:75-87\r\nconst estimateImageSize = useCallback((element?: HTMLImageElement): number => {\r\n  if (!element || !element.naturalWidth || !element.naturalHeight) {\r\n    return optionsRef.current.estimatedImageSize;\r\n  }\r\n  // åŸºäºå›¾ç‰‡å°ºå¯¸çš„ç®€å•ä¼°ç®— - ä¸å¤Ÿç²¾ç¡®\r\n  const pixels = element.naturalWidth * element.naturalHeight;\r\n  const bytesPerPixel = 4; // RGBA - å›ºå®šå€¼ä¸å‡†ç¡®\r\n  return pixels * bytesPerPixel;\r\n}, []);\r\n```\r\n\r\n- **é—®é¢˜**: å†…å­˜ä¼°ç®—ä¸å‡†ç¡®ï¼Œå¯èƒ½å¯¼è‡´å†…å­˜ç®¡ç†ç­–ç•¥å¤±æ•ˆ\r\n- **å½±å“**: å†…å­˜æ³„æ¼é£é™©ã€æ€§èƒ½ä¸‹é™\r\n\r\n#### 2.2 Worker çº¿ç¨‹æ± è¿‡åº¦è®¾è®¡\r\n\r\n```typescript\r\n// é—®é¢˜ä»£ç ç¤ºä¾‹ - lqipWorkerPool.ts:64-74\r\nconstructor(options: WorkerPoolOptions = {}) {\r\n  this.options = {\r\n    maxWorkers: options.maxWorkers || Math.min(navigator.hardwareConcurrency || 2, 4),\r\n    // åˆ›å»ºå¤šä¸ª Worker å®ä¾‹ï¼Œä½†å®é™…ä½¿ç”¨ä¸­å¯èƒ½ä¸éœ€è¦\r\n  };\r\n}\r\n```\r\n\r\n- **é—®é¢˜**: ä¸ºç®€å•çš„ LQIP ç”Ÿæˆåˆ›å»ºå¤æ‚çš„çº¿ç¨‹æ± \r\n- **å½±å“**: èµ„æºæµªè´¹ã€åˆå§‹åŒ–å¼€é”€å¤§\r\n\r\n#### 2.3 å¹¶å‘æ§åˆ¶è¿‡äºå¤æ‚\r\n\r\n```typescript\r\n// é—®é¢˜ä»£ç ç¤ºä¾‹ - concurrency.ts:68-92\r\nexport function enqueueLoad<T>(\r\n  startFn: () => Promise<T>,\r\n  priority: \"low\" | \"medium\" | \"high\" = \"medium\"\r\n) {\r\n  return new Promise<T>((resolve, reject) => {\r\n    const run = () => {\r\n      IN_FLIGHT++;\r\n      startFn()\r\n        .then((result) => {\r\n          IN_FLIGHT--;\r\n          dequeue();\r\n          resolve(result);\r\n        })\r\n        .catch((err) => {\r\n          IN_FLIGHT--;\r\n          dequeue();\r\n          reject(err);\r\n        });\r\n    };\r\n    // å¤æ‚çš„ä¼˜å…ˆçº§å¤„ç†é€»è¾‘\r\n  });\r\n}\r\n```\r\n\r\n- **é—®é¢˜**: å¹¶å‘æ§åˆ¶é€»è¾‘å¤æ‚ï¼Œä½†å®é™…æ•ˆæœæœ‰é™\r\n- **å½±å“**: ä»£ç å¤æ‚åº¦é«˜ã€ç»´æŠ¤å›°éš¾\r\n\r\n### 3. ä»£ç é‡å¤å’Œå†—ä½™\r\n\r\n#### 3.1 é‡å¤çš„ IntersectionObserver é€»è¾‘\r\n\r\n- **é—®é¢˜**: `useInView` å’Œ `useEnhancedInView` éƒ½å®ç°äº† IntersectionObserver\r\n- **å½±å“**: ä»£ç é‡å¤ã€ç»´æŠ¤æˆæœ¬é«˜\r\n- **å»ºè®®**: æå–å…¬å…±çš„ IntersectionObserver é€»è¾‘\r\n\r\n#### 3.2 é‡å¤çš„ç¼“å­˜ç®¡ç†\r\n\r\n- **é—®é¢˜**: `useImageCache` å’Œ `useMemoryManager` éƒ½æ¶‰åŠç¼“å­˜\r\n- **å½±å“**: ç¼“å­˜ç­–ç•¥ä¸ä¸€è‡´ã€èµ„æºæµªè´¹\r\n- **å»ºè®®**: ç»Ÿä¸€ç¼“å­˜ç®¡ç†ç­–ç•¥\r\n\r\n#### 3.3 é‡å¤çš„é”™è¯¯å¤„ç†\r\n\r\n- **é—®é¢˜**: å¤šä¸ªç»„ä»¶éƒ½æœ‰ç±»ä¼¼çš„é”™è¯¯å¤„ç†é€»è¾‘\r\n- **å½±å“**: é”™è¯¯å¤„ç†ä¸ä¸€è‡´ã€ä»£ç å†—ä½™\r\n- **å»ºè®®**: æå–å…¬å…±çš„é”™è¯¯å¤„ç† Hook\r\n\r\n### 4. ç±»å‹ç³»ç»Ÿé—®é¢˜\r\n\r\n#### 4.1 ç±»å‹å®šä¹‰è¿‡äºå¤æ‚\r\n\r\n```typescript\r\n// é—®é¢˜ä»£ç ç¤ºä¾‹ - types/index.ts:16-92\r\nexport interface LazyImageProps {\r\n  // 77ä¸ªå±æ€§ï¼Œè¿‡äºå¤æ‚\r\n  src: string;\r\n  alt?: string;\r\n  style?: CSSProperties;\r\n  // ... 74ä¸ªå…¶ä»–å±æ€§\r\n}\r\n```\r\n\r\n- **é—®é¢˜**: Props æ¥å£è¿‡äºå¤æ‚ï¼ŒåŒ…å« 77 ä¸ªå±æ€§\r\n- **å½±å“**: ä½¿ç”¨å›°éš¾ã€ç±»å‹æ£€æŸ¥å¤æ‚\r\n\r\n#### 4.2 ç±»å‹å®‰å…¨æ€§ä¸è¶³\r\n\r\n- **é—®é¢˜**: å¤§é‡ä½¿ç”¨ `any` ç±»å‹å’Œç±»å‹æ–­è¨€\r\n- **å½±å“**: è¿è¡Œæ—¶é”™è¯¯é£é™©ã€å¼€å‘ä½“éªŒå·®\r\n\r\n## ğŸš€ ä¼˜åŒ–å»ºè®®\r\n\r\n### 1. æ¶æ„é‡æ„å»ºè®®\r\n\r\n#### 1.1 ç»„ä»¶æ‹†åˆ†\r\n\r\n```typescript\r\n// å»ºè®®çš„æ–°æ¶æ„\r\ninterface LazyImageCoreProps {\r\n  src: string;\r\n  alt?: string;\r\n  // åªä¿ç•™æ ¸å¿ƒå±æ€§\r\n}\r\n\r\ninterface LazyImageAdvancedProps extends LazyImageCoreProps {\r\n  // é«˜çº§åŠŸèƒ½å±æ€§\r\n  enableLQIP?: boolean;\r\n  enableMemoryManagement?: boolean;\r\n  // ...\r\n}\r\n\r\n// åŸºç¡€ç»„ä»¶\r\nconst LazyImageCore: React.FC<LazyImageCoreProps> = (props) => {\r\n  // åªå¤„ç†åŸºç¡€æ‡’åŠ è½½\r\n};\r\n\r\n// å¢å¼ºç»„ä»¶\r\nconst LazyImageAdvanced: React.FC<LazyImageAdvancedProps> = (props) => {\r\n  // å¤„ç†é«˜çº§åŠŸèƒ½\r\n};\r\n```\r\n\r\n#### 1.2 Hook é‡æ„\r\n\r\n```typescript\r\n// å»ºè®®çš„ Hook ç»“æ„\r\nconst useLazyImageCore = (src: string, options: CoreOptions) => {\r\n  // æ ¸å¿ƒæ‡’åŠ è½½é€»è¾‘\r\n};\r\n\r\nconst useLazyImageLQIP = (src: string, options: LQIPOptions) => {\r\n  // LQIP ç”Ÿæˆé€»è¾‘\r\n};\r\n\r\nconst useLazyImageMemory = (options: MemoryOptions) => {\r\n  // å†…å­˜ç®¡ç†é€»è¾‘\r\n};\r\n```\r\n\r\n### 2. æ€§èƒ½ä¼˜åŒ–å»ºè®®\r\n\r\n#### 2.1 ç®€åŒ–å†…å­˜ç®¡ç†\r\n\r\n```typescript\r\n// ä¼˜åŒ–åçš„å†…å­˜ç®¡ç†\r\nclass SimpleMemoryManager {\r\n  private images = new Map<string, ImageInfo>();\r\n  private maxSize = 100 * 1024 * 1024; // 100MB\r\n\r\n  registerImage(src: string, element: HTMLImageElement) {\r\n    // ç®€åŒ–çš„æ³¨å†Œé€»è¾‘\r\n    const size = this.estimateSize(element);\r\n    this.images.set(src, { element, size, lastAccess: Date.now() });\r\n    this.cleanupIfNeeded();\r\n  }\r\n\r\n  private estimateSize(element: HTMLImageElement): number {\r\n    // æ›´å‡†ç¡®çš„å¤§å°ä¼°ç®—\r\n    return element.naturalWidth * element.naturalHeight * 4;\r\n  }\r\n}\r\n```\r\n\r\n#### 2.2 ä¼˜åŒ– Worker ä½¿ç”¨\r\n\r\n```typescript\r\n// ç®€åŒ–çš„ LQIP ç”Ÿæˆ\r\nclass SimpleLQIPGenerator {\r\n  private worker: Worker | null = null;\r\n\r\n  async generateLQIP(src: string, options: LQIPOptions): Promise<string> {\r\n    if (!this.worker) {\r\n      this.worker = new Worker(\"/workers/lqip-worker.js\");\r\n    }\r\n\r\n    return new Promise((resolve, reject) => {\r\n      const timeout = setTimeout(() => reject(new Error(\"Timeout\")), 5000);\r\n      this.worker!.onmessage = (e) => {\r\n        clearTimeout(timeout);\r\n        resolve(e.data);\r\n      };\r\n      this.worker!.postMessage({ src, ...options });\r\n    });\r\n  }\r\n}\r\n```\r\n\r\n#### 2.3 ç®€åŒ–å¹¶å‘æ§åˆ¶\r\n\r\n```typescript\r\n// ç®€åŒ–çš„å¹¶å‘æ§åˆ¶\r\nclass SimpleConcurrencyManager {\r\n  private queue: Array<() => Promise<any>> = [];\r\n  private running = 0;\r\n  private maxConcurrency = 3;\r\n\r\n  async enqueue<T>(task: () => Promise<T>): Promise<T> {\r\n    return new Promise((resolve, reject) => {\r\n      this.queue.push(async () => {\r\n        try {\r\n          const result = await task();\r\n          resolve(result);\r\n        } catch (error) {\r\n          reject(error);\r\n        }\r\n      });\r\n      this.process();\r\n    });\r\n  }\r\n\r\n  private async process() {\r\n    if (this.running >= this.maxConcurrency || this.queue.length === 0) {\r\n      return;\r\n    }\r\n\r\n    this.running++;\r\n    const task = this.queue.shift()!;\r\n    await task();\r\n    this.running--;\r\n    this.process();\r\n  }\r\n}\r\n```\r\n\r\n### 3. ä»£ç è´¨é‡æ”¹è¿›\r\n\r\n#### 3.1 æå–å…¬å…±é€»è¾‘\r\n\r\n```typescript\r\n// å…¬å…±çš„ IntersectionObserver Hook\r\nconst useIntersectionObserver = (options: IntersectionObserverOptions) => {\r\n  const [inView, setInView] = useState(false);\r\n  const [ref, setRef] = useState<HTMLElement | null>(null);\r\n\r\n  useEffect(() => {\r\n    if (!ref) return;\r\n\r\n    const observer = new IntersectionObserver(\r\n      ([entry]) => setInView(entry.isIntersecting),\r\n      options\r\n    );\r\n\r\n    observer.observe(ref);\r\n    return () => observer.disconnect();\r\n  }, [ref, options]);\r\n\r\n  return { ref: setRef, inView };\r\n};\r\n```\r\n\r\n#### 3.2 ç»Ÿä¸€é”™è¯¯å¤„ç†\r\n\r\n```typescript\r\n// ç»Ÿä¸€çš„é”™è¯¯å¤„ç† Hook\r\nconst useErrorHandler = () => {\r\n  const [error, setError] = useState<Error | null>(null);\r\n\r\n  const handleError = useCallback((error: Error) => {\r\n    console.error(\"LazyImage Error:\", error);\r\n    setError(error);\r\n  }, []);\r\n\r\n  const clearError = useCallback(() => {\r\n    setError(null);\r\n  }, []);\r\n\r\n  return { error, handleError, clearError };\r\n};\r\n```\r\n\r\n### 4. ç±»å‹ç³»ç»Ÿä¼˜åŒ–\r\n\r\n#### 4.1 ç®€åŒ– Props æ¥å£\r\n\r\n```typescript\r\n// åŸºç¡€ Props\r\ninterface LazyImageBaseProps {\r\n  src: string;\r\n  alt?: string;\r\n  className?: string;\r\n  style?: CSSProperties;\r\n}\r\n\r\n// æ‡’åŠ è½½ Props\r\ninterface LazyImageLazyProps extends LazyImageBaseProps {\r\n  rootMargin?: string;\r\n  threshold?: number;\r\n  loading?: \"lazy\" | \"eager\";\r\n}\r\n\r\n// LQIP Props\r\ninterface LazyImageLQIPProps extends LazyImageLazyProps {\r\n  enableLQIP?: boolean;\r\n  lqipWidth?: number;\r\n  lqipQuality?: number;\r\n}\r\n\r\n// å†…å­˜ç®¡ç† Props\r\ninterface LazyImageMemoryProps extends LazyImageLQIPProps {\r\n  enableMemoryManagement?: boolean;\r\n  maxMemoryUsage?: number;\r\n}\r\n```\r\n\r\n#### 4.2 æ”¹è¿›ç±»å‹å®‰å…¨æ€§\r\n\r\n```typescript\r\n// ç±»å‹å®‰å…¨çš„é…ç½®\r\ninterface LazyImageConfig {\r\n  readonly rootMargin: string;\r\n  readonly threshold: number;\r\n  readonly enableLQIP: boolean;\r\n  readonly lqipWidth: number;\r\n  readonly lqipQuality: number;\r\n}\r\n\r\n// ç±»å‹å®‰å…¨çš„é€‰é¡¹\r\ntype LazyImageOptions = Partial<LazyImageConfig> & {\r\n  src: string;\r\n  alt?: string;\r\n};\r\n```\r\n\r\n## ğŸ“Š ä¼˜åŒ–æ•ˆæœé¢„ä¼°\r\n\r\n### 1. æ€§èƒ½æå‡\r\n\r\n- **å†…å­˜ä½¿ç”¨**: å‡å°‘ 30-50% çš„å†…å­˜å ç”¨\r\n- **åˆå§‹åŒ–æ—¶é—´**: å‡å°‘ 40-60% çš„ç»„ä»¶åˆå§‹åŒ–æ—¶é—´\r\n- **è¿è¡Œæ—¶æ€§èƒ½**: æå‡ 20-30% çš„æ¸²æŸ“æ€§èƒ½\r\n\r\n### 2. ä»£ç è´¨é‡\r\n\r\n- **ä»£ç è¡Œæ•°**: å‡å°‘ 40-50% çš„ä»£ç é‡\r\n- **å¤æ‚åº¦**: é™ä½ 50-60% çš„åœˆå¤æ‚åº¦\r\n- **ç»´æŠ¤æ€§**: æå‡ 70-80% çš„ä»£ç å¯ç»´æŠ¤æ€§\r\n\r\n### 3. å¼€å‘ä½“éªŒ\r\n\r\n- **ç±»å‹å®‰å…¨**: æå‡ 90% çš„ç±»å‹å®‰å…¨æ€§\r\n- **API ç®€æ´æ€§**: ç®€åŒ– 60-70% çš„ API å¤æ‚åº¦\r\n- **æ–‡æ¡£å®Œæ•´æ€§**: æå‡ 80% çš„æ–‡æ¡£è¦†ç›–ç‡\r\n\r\n## ğŸ¯ å®æ–½è®¡åˆ’\r\n\r\n### é˜¶æ®µä¸€ï¼šæ ¸å¿ƒé‡æ„ï¼ˆ2-3 å‘¨ï¼‰\r\n\r\n1. æ‹†åˆ† LazyImage ç»„ä»¶ä¸ºå¤šä¸ªå°ç»„ä»¶\r\n2. é‡æ„ Hook ç³»ç»Ÿï¼Œæ¶ˆé™¤é‡å¤é€»è¾‘\r\n3. ç®€åŒ–ç±»å‹å®šä¹‰\r\n\r\n### é˜¶æ®µäºŒï¼šæ€§èƒ½ä¼˜åŒ–ï¼ˆ1-2 å‘¨ï¼‰\r\n\r\n1. ä¼˜åŒ–å†…å­˜ç®¡ç†ç­–ç•¥\r\n2. ç®€åŒ– Worker ä½¿ç”¨\r\n3. æ”¹è¿›å¹¶å‘æ§åˆ¶\r\n\r\n### é˜¶æ®µä¸‰ï¼šè´¨é‡æå‡ï¼ˆ1 å‘¨ï¼‰\r\n\r\n1. å®Œå–„é”™è¯¯å¤„ç†\r\n2. æ·»åŠ å•å…ƒæµ‹è¯•\r\n3. ä¼˜åŒ–æ–‡æ¡£\r\n\r\n## ğŸ”§ å…·ä½“ä¼˜åŒ–ä»£ç ç¤ºä¾‹\r\n\r\n### 1. ç®€åŒ–çš„æ ¸å¿ƒç»„ä»¶\r\n\r\n```typescript\r\n// ä¼˜åŒ–åçš„æ ¸å¿ƒç»„ä»¶\r\nconst LazyImageCore: React.FC<LazyImageCoreProps> = ({\r\n  src,\r\n  alt,\r\n  className,\r\n  style,\r\n  rootMargin = \"200px\",\r\n  threshold = 0.01,\r\n  loading = \"lazy\",\r\n}) => {\r\n  const { ref, inView } = useIntersectionObserver({\r\n    rootMargin,\r\n    threshold,\r\n  });\r\n\r\n  const [loaded, setLoaded] = useState(false);\r\n  const [error, setError] = useState<Error | null>(null);\r\n\r\n  useEffect(() => {\r\n    if (!inView || loaded) return;\r\n\r\n    const img = new Image();\r\n    img.onload = () => setLoaded(true);\r\n    img.onerror = () => setError(new Error(\"Failed to load image\"));\r\n    img.src = src;\r\n  }, [inView, src, loaded]);\r\n\r\n  return (\r\n    <div ref={ref} className={className} style={style}>\r\n      {!loaded && !error && <div className=\"placeholder\" />}\r\n      {error && <div className=\"error\">Failed to load</div>}\r\n      {loaded && (\r\n        <img src={src} alt={alt} loading={loading} className=\"lazy-image\" />\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n```\r\n\r\n### 2. ç®€åŒ–çš„ LQIP Hook\r\n\r\n```typescript\r\n// ä¼˜åŒ–åçš„ LQIP Hook\r\nconst useLQIP = (src: string, enabled: boolean = false) => {\r\n  const [lqip, setLqip] = useState<string | null>(null);\r\n  const [loading, setLoading] = useState(false);\r\n\r\n  useEffect(() => {\r\n    if (!enabled || !src) return;\r\n\r\n    setLoading(true);\r\n    generateLQIP(src)\r\n      .then(setLqip)\r\n      .catch(console.error)\r\n      .finally(() => setLoading(false));\r\n  }, [src, enabled]);\r\n\r\n  return { lqip, loading };\r\n};\r\n```\r\n\r\n### 3. ç®€åŒ–çš„å†…å­˜ç®¡ç†\r\n\r\n```typescript\r\n// ä¼˜åŒ–åçš„å†…å­˜ç®¡ç†\r\nconst useMemoryManager = (maxSize: number = 100 * 1024 * 1024) => {\r\n  const images = useRef(new Map<string, ImageInfo>());\r\n  const totalSize = useRef(0);\r\n\r\n  const registerImage = useCallback(\r\n    (src: string, element: HTMLImageElement) => {\r\n      const size = element.naturalWidth * element.naturalHeight * 4;\r\n      images.current.set(src, { element, size, lastAccess: Date.now() });\r\n      totalSize.current += size;\r\n\r\n      if (totalSize.current > maxSize) {\r\n        cleanupOldImages();\r\n      }\r\n    },\r\n    [maxSize]\r\n  );\r\n\r\n  const cleanupOldImages = useCallback(() => {\r\n    const sortedImages = Array.from(images.current.entries()).sort(\r\n      (a, b) => a[1].lastAccess - b[1].lastAccess\r\n    );\r\n\r\n    for (const [src, info] of sortedImages) {\r\n      if (totalSize.current <= maxSize * 0.7) break;\r\n\r\n      info.element.src = \"\";\r\n      images.current.delete(src);\r\n      totalSize.current -= info.size;\r\n    }\r\n  }, [maxSize]);\r\n\r\n  return { registerImage };\r\n};\r\n```\r\n\r\n## ğŸ“ˆ æ€»ç»“\r\n\r\nLazyImage ç»„ä»¶è™½ç„¶åŠŸèƒ½ä¸°å¯Œï¼Œä½†å­˜åœ¨æ˜æ˜¾çš„è¿‡åº¦è®¾è®¡é—®é¢˜ã€‚é€šè¿‡æ¶æ„é‡æ„ã€æ€§èƒ½ä¼˜åŒ–å’Œä»£ç ç®€åŒ–ï¼Œå¯ä»¥æ˜¾è‘—æå‡ç»„ä»¶çš„æ€§èƒ½ã€å¯ç»´æŠ¤æ€§å’Œå¼€å‘ä½“éªŒã€‚\r\n\r\n**å…³é”®ä¼˜åŒ–ç‚¹**ï¼š\r\n\r\n1. **æ¶æ„ç®€åŒ–**: ä»å•ä¸€å¤æ‚ç»„ä»¶æ‹†åˆ†ä¸ºå¤šä¸ªèŒè´£æ˜ç¡®çš„å°ç»„ä»¶\r\n2. **æ€§èƒ½ä¼˜åŒ–**: ç®€åŒ–å†…å­˜ç®¡ç†ã€Worker ä½¿ç”¨å’Œå¹¶å‘æ§åˆ¶\r\n3. **ä»£ç è´¨é‡**: æ¶ˆé™¤é‡å¤é€»è¾‘ã€æå‡ç±»å‹å®‰å…¨æ€§\r\n4. **å¼€å‘ä½“éªŒ**: ç®€åŒ– APIã€å®Œå–„æ–‡æ¡£å’Œæµ‹è¯•\r\n\r\n**é¢„æœŸæ”¶ç›Š**ï¼š\r\n\r\n- æ€§èƒ½æå‡ 20-50%\r\n- ä»£ç é‡å‡å°‘ 40-50%\r\n- ç»´æŠ¤æˆæœ¬é™ä½ 60-70%\r\n- å¼€å‘ä½“éªŒæå‡ 80%+\r\n\r\nå»ºè®®æŒ‰ç…§åˆ†é˜¶æ®µçš„æ–¹å¼å®æ–½è¿™äº›ä¼˜åŒ–ï¼Œç¡®ä¿åœ¨æå‡æ€§èƒ½çš„åŒæ—¶ä¿æŒå‘åå…¼å®¹æ€§ã€‚\r\n"
        }
    ]
}