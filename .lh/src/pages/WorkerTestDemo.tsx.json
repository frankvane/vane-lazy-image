{
    "sourceFile": "src/pages/WorkerTestDemo.tsx",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 5,
            "patches": [
                {
                    "date": 1759221334736,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1759222544905,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,172 +1,246 @@\n-/**\r\n- * Worker æµ‹è¯•æ¼”ç¤ºé¡µé¢\r\n- * æµ‹è¯• LQIP Worker åŠŸèƒ½æ˜¯å¦æ­£å¸¸å·¥ä½œ\r\n- */\r\n+import \"vane-lazy-image/style.css\";\r\n \r\n-import React, { useEffect, useState } from \"react\";\r\n import {\r\n-  detectWorkerCapabilities,\r\n-  getWorkerRecommendation,\r\n-  getWorkerStatusReport,\r\n-  testWorkerFunctionality,\r\n-} from \"../components/LazyImage/utils/workerDetection\";\r\n+  LazyImageEnhanced,\r\n+  MemoryCacheMonitor,\r\n+  useEnhancedImageCache,\r\n+  useEnhancedMemoryManager,\r\n+  useScrollManager,\r\n+} from \"vane-lazy-image\";\r\n+import React, { useEffect, useRef, useState } from \"react\";\r\n \r\n-import { LazyImage } from \"../components/LazyImage\";\r\n+const VirtualScrollDemo: React.FC = () => {\r\n+  // ä½¿ç”¨å¢å¼ºç‰ˆ Hook\r\n+  const imageCache = useEnhancedImageCache({\r\n+    maxBytes: 100 * 1024 * 1024, // 100MB\r\n+    enableHitRateTracking: true,\r\n+    enableSizeDistributionAnalysis: true,\r\n+    enableCleanupHistory: true,\r\n+    enableIndexedDBMonitoring: true,\r\n+    enablePerformanceMetrics: true,\r\n+  });\r\n \r\n-const WorkerTestDemo: React.FC = () => {\r\n-  const [workerStatus, setWorkerStatus] = useState<any>(null);\r\n-  const [testResults, setTestResults] = useState<any>(null);\r\n-  const [isLoading, setIsLoading] = useState(false);\r\n+  const memoryManager = useEnhancedMemoryManager({\r\n+    maxMemoryUsage: 120 * 1024 * 1024, // 120MB\r\n+    unloadDistance: 1800,\r\n+    unloadDelay: 4000,\r\n+    enableLifecycleTracking: true,\r\n+    enableLeakDetection: true,\r\n+    enableTrendAnalysis: true,\r\n+  });\r\n \r\n-  // æµ‹è¯•å›¾ç‰‡ URL\r\n-  const testImageUrl = \"https://picsum.photos/800/600?random=1\";\r\n+  const scrollManager = useScrollManager({\r\n+    scrollAxis: \"vertical\",\r\n+    scrollSpeedThreshold: 1.8,\r\n+    bufferZoneMultiplier: 1.6,\r\n+    maxBufferZone: 1000,\r\n+    minBufferZone: 150,\r\n+  });\r\n \r\n-  useEffect(() => {\r\n-    // æ£€æµ‹ Worker èƒ½åŠ›\r\n-    const capabilities = detectWorkerCapabilities();\r\n-    const recommendation = getWorkerRecommendation();\r\n-    const statusReport = getWorkerStatusReport();\r\n+  const [showDebugInfo, setShowDebugInfo] = useState(false);\r\n+  const containerRef = useRef<HTMLDivElement>(null);\r\n \r\n-    setWorkerStatus({\r\n-      capabilities,\r\n-      recommendation,\r\n-      statusReport,\r\n-    });\r\n-  }, []);\r\n+  // ç”Ÿæˆå¤§é‡æµ‹è¯•å›¾ç‰‡\r\n+  const generateImages = (count: number) => {\r\n+    return Array.from({ length: count }, (_, i) => ({\r\n+      id: i,\r\n+      src: `https://picsum.photos/400/300?random=${i + 1000}`,\r\n+      alt: `Test image ${i + 1}`,\r\n+      height: 200 + (i % 5) * 50, // å˜åŒ–çš„é«˜åº¦\r\n+    }));\r\n+  };\r\n \r\n-  const handleTestWorker = async () => {\r\n-    setIsLoading(true);\r\n-    try {\r\n-      const isWorking = await testWorkerFunctionality();\r\n-      setTestResults({\r\n-        isWorking,\r\n-        timestamp: new Date().toISOString(),\r\n-      });\r\n-    } catch (error) {\r\n-      setTestResults({\r\n-        isWorking: false,\r\n-        error: error instanceof Error ? error.message : \"æœªçŸ¥é”™è¯¯\",\r\n-        timestamp: new Date().toISOString(),\r\n-      });\r\n-    } finally {\r\n-      setIsLoading(false);\r\n+  const images = generateImages(200); // 200å¼ å›¾ç‰‡ç”¨äºæµ‹è¯•\r\n+\r\n+  // è®¾ç½®æ»šåŠ¨å®¹å™¨\r\n+  useEffect(() => {\r\n+    if (containerRef.current) {\r\n+      scrollManager.setRoot(containerRef.current);\r\n     }\r\n-  };\r\n+  }, [scrollManager]);\r\n \r\n   return (\r\n-    <div style={{ padding: \"20px\", maxWidth: \"1200px\", margin: \"0 auto\" }}>\r\n-      <h1>Web Worker åŠŸèƒ½æµ‹è¯•</h1>\r\n+    <div style={{ height: \"100vh\", display: \"flex\", flexDirection: \"column\" }}>\r\n+      {/* æ§åˆ¶é¢æ¿ */}\r\n+      <div\r\n+        style={{\r\n+          padding: \"16px\",\r\n+          background: \"#f5f5f5\",\r\n+          borderBottom: \"1px solid #ddd\",\r\n+          flexShrink: 0,\r\n+        }}\r\n+      >\r\n+        <h2 style={{ margin: \"0 0 16px 0\" }}>è™šæ‹Ÿæ»šåŠ¨ LazyImage æ¼”ç¤º</h2>\r\n \r\n-      {/* Worker çŠ¶æ€ä¿¡æ¯ */}\r\n-      <div style={{ marginBottom: \"30px\" }}>\r\n-        <h2>Worker èƒ½åŠ›æ£€æµ‹</h2>\r\n-        {workerStatus && (\r\n-          <div style={{ display: \"grid\", gridTemplateColumns: \"1fr 1fr\", gap: \"20px\" }}>\r\n-            <div>\r\n-              <h3>æµè§ˆå™¨æ”¯æŒæƒ…å†µ</h3>\r\n-              <ul>\r\n-                <li>Web Workers: {workerStatus.capabilities.hasWorker ? \"âœ…\" : \"âŒ\"}</li>\r\n-                <li>OffscreenCanvas: {workerStatus.capabilities.hasOffscreenCanvas ? \"âœ…\" : \"âŒ\"}</li>\r\n-                <li>CreateImageBitmap: {workerStatus.capabilities.hasCreateImageBitmap ? \"âœ…\" : \"âŒ\"}</li>\r\n-                <li>Fetch API: {workerStatus.capabilities.hasFetch ? \"âœ…\" : \"âŒ\"}</li>\r\n-                <li>Transferable Objects: {workerStatus.capabilities.hasTransferableObjects ? \"âœ…\" : \"âŒ\"}</li>\r\n-                <li>æ€§èƒ½ç­‰çº§: {workerStatus.capabilities.estimatedPerformance}</li>\r\n-              </ul>\r\n-            </div>\r\n-            <div>\r\n-              <h3>æ¨èé…ç½®</h3>\r\n-              <ul>\r\n-                <li>ä½¿ç”¨ Worker: {workerStatus.recommendation.shouldUseWorker ? \"âœ…\" : \"âŒ\"}</li>\r\n-                <li>æœ€å¤§ Worker æ•°: {workerStatus.recommendation.maxWorkers}</li>\r\n-                <li>å¯ç”¨é™çº§: {workerStatus.recommendation.enableFallback ? \"âœ…\" : \"âŒ\"}</li>\r\n-                <li>åŸå› : {workerStatus.recommendation.reason}</li>\r\n-              </ul>\r\n-            </div>\r\n-          </div>\r\n-        )}\r\n-      </div>\r\n+        {/* ä½¿ç”¨æ–°çš„ç»Ÿä¸€ç›‘æ§ç»„ä»¶ */}\r\n+        <MemoryCacheMonitor\r\n+          memoryManager={memoryManager}\r\n+          imageCache={imageCache}\r\n+          scrollManager={scrollManager}\r\n+          title=\"è™šæ‹Ÿæ»šåŠ¨æ€§èƒ½ç›‘æ§\"\r\n+          showMemoryChart={true}\r\n+          showCacheChart={true}\r\n+          showScrollInfo={true}\r\n+          showControls={true}\r\n+          updateInterval={1000}\r\n+          style={{ marginBottom: \"16px\" }}\r\n+        />\r\n \r\n-      {/* Worker åŠŸèƒ½æµ‹è¯• */}\r\n-      <div style={{ marginBottom: \"30px\" }}>\r\n-        <h2>Worker åŠŸèƒ½æµ‹è¯•</h2>\r\n-        <button\r\n-          onClick={handleTestWorker}\r\n-          disabled={isLoading}\r\n+        {/* è°ƒè¯•æ§åˆ¶æŒ‰é’® */}\r\n+        <div\r\n           style={{\r\n\\ No newline at end of file\n-            padding: \"10px 20px\",\r\n-            backgroundColor: isLoading ? \"#ccc\" : \"#007bff\",\r\n-            color: \"white\",\r\n-            border: \"none\",\r\n-            borderRadius: \"4px\",\r\n-            cursor: isLoading ? \"not-allowed\" : \"pointer\",\r\n+            background: \"white\",\r\n+            padding: \"12px\",\r\n+            borderRadius: \"8px\",\r\n+            border: \"1px solid #ddd\",\r\n+            display: \"flex\",\r\n+            gap: \"8px\",\r\n+            alignItems: \"center\",\r\n+            marginBottom: \"16px\",\r\n           }}\r\n         >\r\n-          {isLoading ? \"æµ‹è¯•ä¸­...\" : \"æµ‹è¯• Worker åŠŸèƒ½\"}\r\n-        </button>\r\n+          <button\r\n+            onClick={() => setShowDebugInfo(!showDebugInfo)}\r\n+            style={{\r\n+              padding: \"6px 12px\",\r\n+              background: showDebugInfo ? \"#52c41a\" : \"#d9d9d9\",\r\n+              color: showDebugInfo ? \"white\" : \"#666\",\r\n+              border: \"none\",\r\n+              borderRadius: 4,\r\n+              cursor: \"pointer\",\r\n+              fontSize: 12,\r\n+            }}\r\n+          >\r\n+            {showDebugInfo ? \"å…³é—­è°ƒè¯•\" : \"å¼€å¯è°ƒè¯•\"}\r\n+          </button>\r\n \r\n-        {testResults && (\r\n-          <div style={{ marginTop: \"15px\", padding: \"15px\", backgroundColor: \"#f8f9fa\", borderRadius: \"4px\" }}>\r\n-            <h4>æµ‹è¯•ç»“æœ</h4>\r\n-            <p>çŠ¶æ€: {testResults.isWorking ? \"âœ… æ­£å¸¸å·¥ä½œ\" : \"âŒ æ— æ³•å·¥ä½œ\"}</p>\r\n-            <p>æ—¶é—´: {testResults.timestamp}</p>\r\n-            {testResults.error && <p style={{ color: \"red\" }}>é”™è¯¯: {testResults.error}</p>}\r\n-          </div>\r\n-        )}\r\n-      </div>\r\n+          <button\r\n+            onClick={() => {\r\n+              // å¼ºåˆ¶åˆ·æ–°æ‰€æœ‰å›¾ç‰‡\r\n+              window.location.reload();\r\n+            }}\r\n+            style={{\r\n+              padding: \"6px 12px\",\r\n+              background: \"#fa8c16\",\r\n+              color: \"white\",\r\n+              border: \"none\",\r\n+              borderRadius: 4,\r\n+              cursor: \"pointer\",\r\n+              fontSize: 12,\r\n+            }}\r\n+          >\r\n+            ğŸ”„ åˆ·æ–°é¡µé¢\r\n+          </button>\r\n+        </div>\r\n \r\n-      {/* LQIP åŠŸèƒ½æ¼”ç¤º */}\r\n-      <div style={{ marginBottom: \"30px\" }}>\r\n-        <h2>LQIP åŠŸèƒ½æ¼”ç¤º</h2>\r\n-        <p>ä¸‹é¢çš„å›¾ç‰‡å°†ä½¿ç”¨ Web Worker ç”Ÿæˆ LQIPï¼ˆä½è´¨é‡å›¾åƒå ä½ç¬¦ï¼‰ï¼š</p>\r\n-        \r\n-        <div style={{ display: \"grid\", gridTemplateColumns: \"repeat(auto-fit, minmax(300px, 1fr))\", gap: \"20px\" }}>\r\n-          <div>\r\n-            <h4>å¯ç”¨ LQIP Worker</h4>\r\n-            <LazyImage\r\n-              src={testImageUrl}\r\n-              alt=\"æµ‹è¯•å›¾ç‰‡ 1\"\r\n-              style={{ width: \"100%\", height: \"200px\", objectFit: \"cover\" }}\r\n-              enableLQIP={true}\r\n-              lqipWidth={24}\r\n-              lqipQuality={0.6}\r\n-              enableLQIPWorker={true}\r\n-              showLoadingIndicator={true}\r\n-            />\r\n+        {/* è™šæ‹Ÿæ»šåŠ¨ç‰¹æ€§è¯´æ˜ */}\r\n+        <div\r\n+          style={{\r\n+            background: \"white\",\r\n+            padding: \"12px\",\r\n+            borderRadius: \"8px\",\r\n+            border: \"1px solid #ddd\",\r\n+          }}\r\n+        >\r\n+          <h4 style={{ margin: \"0 0 8px 0\", color: \"#333\" }}>\r\n+            è™šæ‹Ÿæ»šåŠ¨ä¼˜åŒ–ç‰¹æ€§\r\n+          </h4>\r\n+          <div\r\n+            style={{\r\n+              fontSize: \"12px\",\r\n+              color: \"#666\",\r\n+              display: \"grid\",\r\n+              gridTemplateColumns: \"repeat(auto-fit, minmax(250px, 1fr))\",\r\n+              gap: \"8px\",\r\n+            }}\r\n+          >\r\n+            <div>âœ… æ™ºèƒ½åŠ è½½ï¼šæ ¹æ®æ»šåŠ¨é€Ÿåº¦è°ƒæ•´åŠ è½½ç­–ç•¥</div>\r\n+            <div>âœ… å†…å­˜ç®¡ç†ï¼šè‡ªåŠ¨å¸è½½ç¦»å¼€è§†çª—çš„å›¾ç‰‡</div>\r\n+            <div>âœ… åŠ¨æ€ç¼“å†²ï¼šæ ¹æ®æ»šåŠ¨æ–¹å‘è°ƒæ•´é¢„åŠ è½½åŒºåŸŸ</div>\r\n+            <div>âœ… ä¼˜å…ˆçº§è°ƒæ•´ï¼šè·ç¦»è§†çª—è¶Šè¿‘ä¼˜å…ˆçº§è¶Šé«˜</div>\r\n+            <div>âœ… ç”Ÿå‘½å‘¨æœŸè¿½è¸ªï¼šè¯¦ç»†çš„å›¾ç‰‡çŠ¶æ€ç›‘æ§</div>\r\n+            <div>âœ… ç¼“å­˜å‘½ä¸­ç‡ï¼šæ™ºèƒ½ç¼“å­˜ç­–ç•¥å’Œæ€§èƒ½åˆ†æ</div>\r\n           </div>\r\n-          \r\n-          <div>\r\n-            <h4>ç¦ç”¨ LQIP Workerï¼ˆä¸»çº¿ç¨‹ï¼‰</h4>\r\n-            <LazyImage\r\n-              src={testImageUrl}\r\n-              alt=\"æµ‹è¯•å›¾ç‰‡ 2\"\r\n-              style={{ width: \"100%\", height: \"200px\", objectFit: \"cover\" }}\r\n-              enableLQIP={true}\r\n-              lqipWidth={24}\r\n-              lqipQuality={0.6}\r\n-              enableLQIPWorker={false}\r\n-              showLoadingIndicator={true}\r\n-            />\r\n+          <div\r\n+            style={{\r\n+              marginTop: \"8px\",\r\n+              padding: \"8px\",\r\n+              backgroundColor: \"#f0f0f0\",\r\n+              borderRadius: \"4px\",\r\n+              fontSize: \"11px\",\r\n+            }}\r\n+          >\r\n+            <strong>å¢å¼ºé…ç½®å‚æ•°:</strong>\r\n+            <br />\r\n+            æ»šåŠ¨é˜ˆå€¼: 1.8 px/ms | å†…å­˜é™åˆ¶: 120MB | å¸è½½è·ç¦»: 1800px\r\n+            <br />\r\n+            ç¼“å­˜å®¹é‡: 100MB | æ³„æ¼æ£€æµ‹: å¼€å¯ | è¶‹åŠ¿åˆ†æ: å¼€å¯\r\n           </div>\r\n         </div>\r\n       </div>\r\n \r\n-      {/* è¯¦ç»†çŠ¶æ€æŠ¥å‘Š */}\r\n-      {workerStatus && (\r\n-        <div style={{ marginBottom: \"30px\" }}>\r\n-          <h2>è¯¦ç»†çŠ¶æ€æŠ¥å‘Š</h2>\r\n-          <pre style={{ \r\n-            backgroundColor: \"#f8f9fa\", \r\n-            padding: \"15px\", \r\n-            borderRadius: \"4px\", \r\n-            overflow: \"auto\",\r\n-            fontSize: \"12px\"\r\n-          }}>\r\n-            {JSON.stringify(workerStatus.statusReport, null, 2)}\r\n-          </pre>\r\n+      {/* æ»šåŠ¨å®¹å™¨ */}\r\n+      <div\r\n+        ref={containerRef}\r\n+        style={{\r\n+          flex: 1,\r\n+          overflow: \"auto\",\r\n+          padding: \"16px\",\r\n+        }}\r\n+      >\r\n+        <div\r\n+          style={{\r\n+            display: \"grid\",\r\n+            gridTemplateColumns: \"repeat(auto-fill, minmax(300px, 1fr))\",\r\n+            gap: \"16px\",\r\n+          }}\r\n+        >\r\n+          {images.map((image, index) => (\r\n+            <div\r\n+              key={image.id}\r\n+              style={{\r\n+                background: \"white\",\r\n+                borderRadius: \"8px\",\r\n+                overflow: \"hidden\",\r\n+                boxShadow: \"0 2px 8px rgba(0,0,0,0.1)\",\r\n+                height: image.height,\r\n+              }}\r\n+            >\r\n+              <LazyImageEnhanced\r\n+                src={image.src}\r\n+                alt={image.alt}\r\n+                style={{\r\n+                  width: \"100%\",\r\n+                  height: \"100%\",\r\n+                  objectFit: \"cover\",\r\n+                }}\r\n+                showLoadingIndicator={true}\r\n+                enableLQIP={true}\r\n+                enableLQIPWorker={true}\r\n+                workerOptions={{\r\n+                  maxWorkers: 2,\r\n+                  taskTimeout: 30000,\r\n+                }}\r\n+              />\r\n+            </div>\r\n+          ))}\r\n         </div>\r\n-      )}\r\n+\r\n+        {/* åº•éƒ¨æç¤º */}\r\n+        <div\r\n+          style={{\r\n+            textAlign: \"center\",\r\n+            padding: \"40px 20px\",\r\n+            color: \"#666\",\r\n+            fontSize: \"14px\",\r\n+          }}\r\n+        >\r\n+          <p>ğŸ‰ å·²åŠ è½½ {images.length} å¼ å›¾ç‰‡</p>\r\n+          <p>å¿«é€Ÿæ»šåŠ¨è¯•è¯•çœ‹ï¼Œè§‚å¯Ÿå†…å­˜ç®¡ç†å’Œæ™ºèƒ½åŠ è½½çš„æ•ˆæœï¼</p>\r\n+        </div>\r\n+      </div>\r\n     </div>\r\n   );\r\n };\r\n \r\n-export default WorkerTestDemo;\n+export default VirtualScrollDemo;\r\n"
                },
                {
                    "date": 1759222637933,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -214,8 +214,14 @@\n                   height: \"100%\",\r\n                   objectFit: \"cover\",\r\n                 }}\r\n                 showLoadingIndicator={true}\r\n+                placeholderStyle={{\r\n+                  background:\r\n+                    \"linear-gradient(45deg, #f0f0f0 25%, transparent 25%), linear-gradient(-45deg, #f0f0f0 25%, transparent 25%), linear-gradient(45deg, transparent 75%, #f0f0f0 75%), linear-gradient(-45deg, transparent 75%, #f0f0f0 75%)\",\r\n+                  backgroundSize: \"20px 20px\",\r\n+                  backgroundPosition: \"0 0, 0 10px, 10px -10px, -10px 0px\",\r\n+                }}\r\n                 enableLQIP={true}\r\n                 enableLQIPWorker={true}\r\n                 workerOptions={{\r\n                   maxWorkers: 2,\r\n@@ -242,5 +248,5 @@\n     </div>\r\n   );\r\n };\r\n \r\n-export default VirtualScrollDemo;\n\\ No newline at end of file\n+export default VirtualScrollDemo;\r\n"
                },
                {
                    "date": 1759222684988,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -213,9 +213,8 @@\n                   width: \"100%\",\r\n                   height: \"100%\",\r\n                   objectFit: \"cover\",\r\n                 }}\r\n-                showLoadingIndicator={true}\r\n                 placeholderStyle={{\r\n                   background:\r\n                     \"linear-gradient(45deg, #f0f0f0 25%, transparent 25%), linear-gradient(-45deg, #f0f0f0 25%, transparent 25%), linear-gradient(45deg, transparent 75%, #f0f0f0 75%), linear-gradient(-45deg, transparent 75%, #f0f0f0 75%)\",\r\n                   backgroundSize: \"20px 20px\",\r\n"
                },
                {
                    "date": 1759222738675,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -213,14 +213,8 @@\n                   width: \"100%\",\r\n                   height: \"100%\",\r\n                   objectFit: \"cover\",\r\n                 }}\r\n-                placeholderStyle={{\r\n-                  background:\r\n-                    \"linear-gradient(45deg, #f0f0f0 25%, transparent 25%), linear-gradient(-45deg, #f0f0f0 25%, transparent 25%), linear-gradient(45deg, transparent 75%, #f0f0f0 75%), linear-gradient(-45deg, transparent 75%, #f0f0f0 75%)\",\r\n-                  backgroundSize: \"20px 20px\",\r\n-                  backgroundPosition: \"0 0, 0 10px, 10px -10px, -10px 0px\",\r\n-                }}\r\n                 enableLQIP={true}\r\n                 enableLQIPWorker={true}\r\n                 workerOptions={{\r\n                   maxWorkers: 2,\r\n"
                },
                {
                    "date": 1759223181189,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,13 +1,13 @@\n-import \"vane-lazy-image/style.css\";\r\n+import \"../components/LazyImage/style/style.module.css\";\r\n \r\n import {\r\n   LazyImageEnhanced,\r\n   MemoryCacheMonitor,\r\n   useEnhancedImageCache,\r\n   useEnhancedMemoryManager,\r\n   useScrollManager,\r\n-} from \"vane-lazy-image\";\r\n+} from \"../components/LazyImage\";\r\n import React, { useEffect, useRef, useState } from \"react\";\r\n \r\n const VirtualScrollDemo: React.FC = () => {\r\n   // ä½¿ç”¨å¢å¼ºç‰ˆ Hook\r\n@@ -194,9 +194,9 @@\n             gridTemplateColumns: \"repeat(auto-fill, minmax(300px, 1fr))\",\r\n             gap: \"16px\",\r\n           }}\r\n         >\r\n-          {images.map((image, index) => (\r\n+          {images.map((image) => (\r\n             <div\r\n               key={image.id}\r\n               style={{\r\n                 background: \"white\",\r\n"
                }
            ],
            "date": 1759221334736,
            "name": "Commit-0",
            "content": "/**\r\n * Worker æµ‹è¯•æ¼”ç¤ºé¡µé¢\r\n * æµ‹è¯• LQIP Worker åŠŸèƒ½æ˜¯å¦æ­£å¸¸å·¥ä½œ\r\n */\r\n\r\nimport React, { useEffect, useState } from \"react\";\r\nimport {\r\n  detectWorkerCapabilities,\r\n  getWorkerRecommendation,\r\n  getWorkerStatusReport,\r\n  testWorkerFunctionality,\r\n} from \"../components/LazyImage/utils/workerDetection\";\r\n\r\nimport { LazyImage } from \"../components/LazyImage\";\r\n\r\nconst WorkerTestDemo: React.FC = () => {\r\n  const [workerStatus, setWorkerStatus] = useState<any>(null);\r\n  const [testResults, setTestResults] = useState<any>(null);\r\n  const [isLoading, setIsLoading] = useState(false);\r\n\r\n  // æµ‹è¯•å›¾ç‰‡ URL\r\n  const testImageUrl = \"https://picsum.photos/800/600?random=1\";\r\n\r\n  useEffect(() => {\r\n    // æ£€æµ‹ Worker èƒ½åŠ›\r\n    const capabilities = detectWorkerCapabilities();\r\n    const recommendation = getWorkerRecommendation();\r\n    const statusReport = getWorkerStatusReport();\r\n\r\n    setWorkerStatus({\r\n      capabilities,\r\n      recommendation,\r\n      statusReport,\r\n    });\r\n  }, []);\r\n\r\n  const handleTestWorker = async () => {\r\n    setIsLoading(true);\r\n    try {\r\n      const isWorking = await testWorkerFunctionality();\r\n      setTestResults({\r\n        isWorking,\r\n        timestamp: new Date().toISOString(),\r\n      });\r\n    } catch (error) {\r\n      setTestResults({\r\n        isWorking: false,\r\n        error: error instanceof Error ? error.message : \"æœªçŸ¥é”™è¯¯\",\r\n        timestamp: new Date().toISOString(),\r\n      });\r\n    } finally {\r\n      setIsLoading(false);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div style={{ padding: \"20px\", maxWidth: \"1200px\", margin: \"0 auto\" }}>\r\n      <h1>Web Worker åŠŸèƒ½æµ‹è¯•</h1>\r\n\r\n      {/* Worker çŠ¶æ€ä¿¡æ¯ */}\r\n      <div style={{ marginBottom: \"30px\" }}>\r\n        <h2>Worker èƒ½åŠ›æ£€æµ‹</h2>\r\n        {workerStatus && (\r\n          <div style={{ display: \"grid\", gridTemplateColumns: \"1fr 1fr\", gap: \"20px\" }}>\r\n            <div>\r\n              <h3>æµè§ˆå™¨æ”¯æŒæƒ…å†µ</h3>\r\n              <ul>\r\n                <li>Web Workers: {workerStatus.capabilities.hasWorker ? \"âœ…\" : \"âŒ\"}</li>\r\n                <li>OffscreenCanvas: {workerStatus.capabilities.hasOffscreenCanvas ? \"âœ…\" : \"âŒ\"}</li>\r\n                <li>CreateImageBitmap: {workerStatus.capabilities.hasCreateImageBitmap ? \"âœ…\" : \"âŒ\"}</li>\r\n                <li>Fetch API: {workerStatus.capabilities.hasFetch ? \"âœ…\" : \"âŒ\"}</li>\r\n                <li>Transferable Objects: {workerStatus.capabilities.hasTransferableObjects ? \"âœ…\" : \"âŒ\"}</li>\r\n                <li>æ€§èƒ½ç­‰çº§: {workerStatus.capabilities.estimatedPerformance}</li>\r\n              </ul>\r\n            </div>\r\n            <div>\r\n              <h3>æ¨èé…ç½®</h3>\r\n              <ul>\r\n                <li>ä½¿ç”¨ Worker: {workerStatus.recommendation.shouldUseWorker ? \"âœ…\" : \"âŒ\"}</li>\r\n                <li>æœ€å¤§ Worker æ•°: {workerStatus.recommendation.maxWorkers}</li>\r\n                <li>å¯ç”¨é™çº§: {workerStatus.recommendation.enableFallback ? \"âœ…\" : \"âŒ\"}</li>\r\n                <li>åŸå› : {workerStatus.recommendation.reason}</li>\r\n              </ul>\r\n            </div>\r\n          </div>\r\n        )}\r\n      </div>\r\n\r\n      {/* Worker åŠŸèƒ½æµ‹è¯• */}\r\n      <div style={{ marginBottom: \"30px\" }}>\r\n        <h2>Worker åŠŸèƒ½æµ‹è¯•</h2>\r\n        <button\r\n          onClick={handleTestWorker}\r\n          disabled={isLoading}\r\n          style={{\r\n            padding: \"10px 20px\",\r\n            backgroundColor: isLoading ? \"#ccc\" : \"#007bff\",\r\n            color: \"white\",\r\n            border: \"none\",\r\n            borderRadius: \"4px\",\r\n            cursor: isLoading ? \"not-allowed\" : \"pointer\",\r\n          }}\r\n        >\r\n          {isLoading ? \"æµ‹è¯•ä¸­...\" : \"æµ‹è¯• Worker åŠŸèƒ½\"}\r\n        </button>\r\n\r\n        {testResults && (\r\n          <div style={{ marginTop: \"15px\", padding: \"15px\", backgroundColor: \"#f8f9fa\", borderRadius: \"4px\" }}>\r\n            <h4>æµ‹è¯•ç»“æœ</h4>\r\n            <p>çŠ¶æ€: {testResults.isWorking ? \"âœ… æ­£å¸¸å·¥ä½œ\" : \"âŒ æ— æ³•å·¥ä½œ\"}</p>\r\n            <p>æ—¶é—´: {testResults.timestamp}</p>\r\n            {testResults.error && <p style={{ color: \"red\" }}>é”™è¯¯: {testResults.error}</p>}\r\n          </div>\r\n        )}\r\n      </div>\r\n\r\n      {/* LQIP åŠŸèƒ½æ¼”ç¤º */}\r\n      <div style={{ marginBottom: \"30px\" }}>\r\n        <h2>LQIP åŠŸèƒ½æ¼”ç¤º</h2>\r\n        <p>ä¸‹é¢çš„å›¾ç‰‡å°†ä½¿ç”¨ Web Worker ç”Ÿæˆ LQIPï¼ˆä½è´¨é‡å›¾åƒå ä½ç¬¦ï¼‰ï¼š</p>\r\n        \r\n        <div style={{ display: \"grid\", gridTemplateColumns: \"repeat(auto-fit, minmax(300px, 1fr))\", gap: \"20px\" }}>\r\n          <div>\r\n            <h4>å¯ç”¨ LQIP Worker</h4>\r\n            <LazyImage\r\n              src={testImageUrl}\r\n              alt=\"æµ‹è¯•å›¾ç‰‡ 1\"\r\n              style={{ width: \"100%\", height: \"200px\", objectFit: \"cover\" }}\r\n              enableLQIP={true}\r\n              lqipWidth={24}\r\n              lqipQuality={0.6}\r\n              enableLQIPWorker={true}\r\n              showLoadingIndicator={true}\r\n            />\r\n          </div>\r\n          \r\n          <div>\r\n            <h4>ç¦ç”¨ LQIP Workerï¼ˆä¸»çº¿ç¨‹ï¼‰</h4>\r\n            <LazyImage\r\n              src={testImageUrl}\r\n              alt=\"æµ‹è¯•å›¾ç‰‡ 2\"\r\n              style={{ width: \"100%\", height: \"200px\", objectFit: \"cover\" }}\r\n              enableLQIP={true}\r\n              lqipWidth={24}\r\n              lqipQuality={0.6}\r\n              enableLQIPWorker={false}\r\n              showLoadingIndicator={true}\r\n            />\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      {/* è¯¦ç»†çŠ¶æ€æŠ¥å‘Š */}\r\n      {workerStatus && (\r\n        <div style={{ marginBottom: \"30px\" }}>\r\n          <h2>è¯¦ç»†çŠ¶æ€æŠ¥å‘Š</h2>\r\n          <pre style={{ \r\n            backgroundColor: \"#f8f9fa\", \r\n            padding: \"15px\", \r\n            borderRadius: \"4px\", \r\n            overflow: \"auto\",\r\n            fontSize: \"12px\"\r\n          }}>\r\n            {JSON.stringify(workerStatus.statusReport, null, 2)}\r\n          </pre>\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default WorkerTestDemo;"
        }
    ]
}