{
    "sourceFile": "src/pages/DiagnosticDemo.tsx",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 1,
            "patches": [
                {
                    "date": 1759223181070,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1759223850459,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -22,9 +22,9 @@\n     { name: \"å¤§é‡å›¾ç‰‡ (100å¼ )\", count: 100, enableWorker: true },\r\n     { name: \"å¤§é‡å›¾ç‰‡æ— Worker (100å¼ )\", count: 100, enableWorker: false },\r\n   ];\r\n \r\n-  const runDiagnostic = async (config: typeof testConfigs[0]) => {\r\n+  const runDiagnostic = async (config: (typeof testConfigs)[0]) => {\r\n     setIsRunning(true);\r\n     setTestPhase(`æ­£åœ¨æµ‹è¯•: ${config.name}`);\r\n     monitor.reset();\r\n \r\n@@ -87,9 +87,9 @@\n         images.forEach(() => handleImageLoad());\r\n       }, 1000);\r\n \r\n       // ç­‰å¾…å½“å‰æµ‹è¯•å®Œæˆ\r\n-      await new Promise(resolve => setTimeout(resolve, 3000));\r\n+      await new Promise((resolve) => setTimeout(resolve, 3000));\r\n     }\r\n   };\r\n \r\n   // ç§»é™¤æœªä½¿ç”¨çš„å‡½æ•°\r\n@@ -99,30 +99,72 @@\n       <h1>LazyImage æ€§èƒ½è¯Šæ–­å·¥å…·</h1>\r\n \r\n       <div style={{ marginBottom: \"30px\" }}>\r\n         <h2>é—®é¢˜åˆ†æ</h2>\r\n-        <div style={{ backgroundColor: \"#fff3cd\", padding: \"15px\", borderRadius: \"8px\", marginBottom: \"20px\" }}>\r\n+        <div\r\n+          style={{\r\n+            backgroundColor: \"#fff3cd\",\r\n+            padding: \"15px\",\r\n+            borderRadius: \"8px\",\r\n+            marginBottom: \"20px\",\r\n+          }}\r\n+        >\r\n           <h4>ğŸ” WorkerTestDemo é•¿æ—¶é—´ç­‰å¾…çš„å¯èƒ½åŸå› ï¼š</h4>\r\n           <ul>\r\n-            <li><strong>Worker åˆå§‹åŒ–å»¶è¿Ÿ</strong> - Web Worker éœ€è¦æ—¶é—´å¯åŠ¨å’ŒåŠ è½½è„šæœ¬</li>\r\n-            <li><strong>LQIP ç”Ÿæˆè€—æ—¶</strong> - æ¯å¼ å›¾ç‰‡éƒ½éœ€è¦å…ˆä¸‹è½½åŸå›¾å†ç”Ÿæˆç¼©ç•¥å›¾</li>\r\n-            <li><strong>å¤§é‡å¹¶å‘è¯·æ±‚</strong> - 200å¼ å›¾ç‰‡åŒæ—¶è¯·æ±‚å¯èƒ½è§¦å‘æµè§ˆå™¨é™åˆ¶</li>\r\n-            <li><strong>å¤æ‚ç›‘æ§ç³»ç»Ÿ</strong> - å¯ç”¨äº†å¤ªå¤šæ€§èƒ½åˆ†æåŠŸèƒ½</li>\r\n-            <li><strong>å†…å­˜ç®¡ç†å¼€é”€</strong> - å†…å­˜ç›‘æ§å’Œæ¸…ç†æœºåˆ¶å¢åŠ å»¶è¿Ÿ</li>\r\n-            <li><strong>ç½‘ç»œå»¶è¿Ÿ</strong> - picsum.photos å¯èƒ½æœ‰è¯·æ±‚é¢‘ç‡é™åˆ¶</li>\r\n+            <li>\r\n+              <strong>Worker åˆå§‹åŒ–å»¶è¿Ÿ</strong> - Web Worker\r\n+              éœ€è¦æ—¶é—´å¯åŠ¨å’ŒåŠ è½½è„šæœ¬\r\n+            </li>\r\n+            <li>\r\n+              <strong>LQIP ç”Ÿæˆè€—æ—¶</strong> -\r\n+              æ¯å¼ å›¾ç‰‡éƒ½éœ€è¦å…ˆä¸‹è½½åŸå›¾å†ç”Ÿæˆç¼©ç•¥å›¾\r\n+            </li>\r\n+            <li>\r\n+              <strong>å¤§é‡å¹¶å‘è¯·æ±‚</strong> -\r\n+              200å¼ å›¾ç‰‡åŒæ—¶è¯·æ±‚å¯èƒ½è§¦å‘æµè§ˆå™¨é™åˆ¶\r\n+            </li>\r\n+            <li>\r\n+              <strong>å¤æ‚ç›‘æ§ç³»ç»Ÿ</strong> - å¯ç”¨äº†å¤ªå¤šæ€§èƒ½åˆ†æåŠŸèƒ½\r\n+            </li>\r\n+            <li>\r\n+              <strong>å†…å­˜ç®¡ç†å¼€é”€</strong> - å†…å­˜ç›‘æ§å’Œæ¸…ç†æœºåˆ¶å¢åŠ å»¶è¿Ÿ\r\n+            </li>\r\n+            <li>\r\n+              <strong>ç½‘ç»œå»¶è¿Ÿ</strong> - picsum.photos å¯èƒ½æœ‰è¯·æ±‚é¢‘ç‡é™åˆ¶\r\n+            </li>\r\n           </ul>\r\n         </div>\r\n \r\n-        <div style={{ backgroundColor: \"#d1ecf1\", padding: \"15px\", borderRadius: \"8px\" }}>\r\n+        <div\r\n+          style={{\r\n+            backgroundColor: \"#d1ecf1\",\r\n+            padding: \"15px\",\r\n+            borderRadius: \"8px\",\r\n+          }}\r\n+        >\r\n           <h4>ğŸ’¡ ä¼˜åŒ–å»ºè®®ï¼š</h4>\r\n           <ul>\r\n-            <li>âœ… <strong>å‡å°‘åˆå§‹å›¾ç‰‡æ•°é‡</strong> - ä» 200 å¼ å‡å°‘åˆ° 20-50 å¼ </li>\r\n-            <li>âœ… <strong>å¯ç”¨ä¼˜å…ˆçº§åŠ è½½</strong> - ä¼˜å…ˆåŠ è½½å¯è§åŒºåŸŸçš„å›¾ç‰‡</li>\r\n-            <li>âœ… <strong>ä¼˜åŒ– LQIP å‚æ•°</strong> - é™ä½è´¨é‡å’Œå°ºå¯¸ (16px, 0.5)</li>\r\n-            <li>âœ… <strong>ç®€åŒ–ç›‘æ§é…ç½®</strong> - å…³é—­ä¸å¿…è¦çš„æ€§èƒ½åˆ†æ</li>\r\n-            <li>âœ… <strong>ä½¿ç”¨æœ¬åœ°å›¾ç‰‡</strong> - é¿å…ç½‘ç»œè¯·æ±‚å»¶è¿Ÿ</li>\r\n-            <li>âœ… <strong>é¢„åŠ è½½ Worker</strong> - æå‰åˆå§‹åŒ– Worker æ± </li>\r\n-            <li>âœ… <strong>åˆ†æ‰¹åŠ è½½</strong> - ä½¿ç”¨è™šæ‹Ÿæ»šåŠ¨æˆ–åˆ†é¡µ</li>\r\n+            <li>\r\n+              âœ… <strong>å‡å°‘åˆå§‹å›¾ç‰‡æ•°é‡</strong> - ä» 200 å¼ å‡å°‘åˆ° 20-50 å¼ \r\n+            </li>\r\n+            <li>\r\n+              âœ… <strong>å¯ç”¨ä¼˜å…ˆçº§åŠ è½½</strong> - ä¼˜å…ˆåŠ è½½å¯è§åŒºåŸŸçš„å›¾ç‰‡\r\n+            </li>\r\n+            <li>\r\n+              âœ… <strong>ä¼˜åŒ– LQIP å‚æ•°</strong> - é™ä½è´¨é‡å’Œå°ºå¯¸ (16px, 0.5)\r\n+            </li>\r\n+            <li>\r\n+              âœ… <strong>ç®€åŒ–ç›‘æ§é…ç½®</strong> - å…³é—­ä¸å¿…è¦çš„æ€§èƒ½åˆ†æ\r\n+            </li>\r\n+            <li>\r\n+              âœ… <strong>ä½¿ç”¨æœ¬åœ°å›¾ç‰‡</strong> - é¿å…ç½‘ç»œè¯·æ±‚å»¶è¿Ÿ\r\n+            </li>\r\n+            <li>\r\n+              âœ… <strong>é¢„åŠ è½½ Worker</strong> - æå‰åˆå§‹åŒ– Worker æ± \r\n+            </li>\r\n+            <li>\r\n+              âœ… <strong>åˆ†æ‰¹åŠ è½½</strong> - ä½¿ç”¨è™šæ‹Ÿæ»šåŠ¨æˆ–åˆ†é¡µ\r\n+            </li>\r\n           </ul>\r\n         </div>\r\n       </div>\r\n \r\n@@ -146,57 +188,109 @@\n \r\n         {diagnosticResults && (\r\n           <div>\r\n             <h3>è¯Šæ–­ç»“æœ</h3>\r\n-            {Object.entries(diagnosticResults).map(([testName, result]: [string, any]) => (\r\n-              <div key={testName} style={{ marginBottom: \"20px\", padding: \"15px\", backgroundColor: \"#f8f9fa\", borderRadius: \"8px\" }}>\r\n-                <h4>{testName}</h4>\r\n-                <div style={{ display: \"grid\", gridTemplateColumns: \"1fr 1fr\", gap: \"20px\" }}>\r\n-                  <div>\r\n-                    <h5>æ€§èƒ½æŒ‡æ ‡</h5>\r\n-                    <ul style={{ fontSize: \"14px\" }}>\r\n-                      <li>ç»„ä»¶æŒ‚è½½: {result.metrics.componentMountTime?.toFixed(2)}ms</li>\r\n-                      <li>é¦–å›¾åŠ è½½: {result.metrics.firstImageLoadTime?.toFixed(2)}ms</li>\r\n-                      <li>Worker åˆå§‹åŒ–: {result.metrics.workerInitTime?.toFixed(2)}ms</li>\r\n-                      <li>å¹³å‡åŠ è½½: {result.metrics.averageLoadTime?.toFixed(2)}ms</li>\r\n-                      <li>ç½‘ç»œè¯·æ±‚: {result.metrics.networkRequests}</li>\r\n-                      <li>å†…å­˜ä½¿ç”¨: {result.metrics.memoryUsage ? (result.metrics.memoryUsage / 1024 / 1024).toFixed(2) + \"MB\" : \"N/A\"}</li>\r\n-                    </ul>\r\n-                  </div>\r\n-                  <div>\r\n-                    <h5>é—®é¢˜å’Œå»ºè®®</h5>\r\n-                    {result.issues.length > 0 ? (\r\n-                      <ul style={{ fontSize: \"14px\", color: \"#dc3545\" }}>\r\n-                        {result.issues.map((issue: string, index: number) => (\r\n-                          <li key={index}>{issue}</li>\r\n-                        ))}\r\n+            {Object.entries(diagnosticResults).map(\r\n+              ([testName, result]: [string, any]) => (\r\n+                <div\r\n+                  key={testName}\r\n+                  style={{\r\n+                    marginBottom: \"20px\",\r\n+                    padding: \"15px\",\r\n+                    backgroundColor: \"#f8f9fa\",\r\n+                    borderRadius: \"8px\",\r\n+                  }}\r\n+                >\r\n+                  <h4>{testName}</h4>\r\n+                  <div\r\n+                    style={{\r\n+                      display: \"grid\",\r\n+                      gridTemplateColumns: \"1fr 1fr\",\r\n+                      gap: \"20px\",\r\n+                    }}\r\n+                  >\r\n+                    <div>\r\n+                      <h5>æ€§èƒ½æŒ‡æ ‡</h5>\r\n+                      <ul style={{ fontSize: \"14px\" }}>\r\n+                        <li>\r\n+                          ç»„ä»¶æŒ‚è½½:{\" \"}\r\n+                          {result.metrics.componentMountTime?.toFixed(2)}ms\r\n+                        </li>\r\n+                        <li>\r\n+                          é¦–å›¾åŠ è½½:{\" \"}\r\n+                          {result.metrics.firstImageLoadTime?.toFixed(2)}ms\r\n+                        </li>\r\n+                        <li>\r\n+                          Worker åˆå§‹åŒ–:{\" \"}\r\n+                          {result.metrics.workerInitTime?.toFixed(2)}ms\r\n+                        </li>\r\n+                        <li>\r\n+                          å¹³å‡åŠ è½½: {result.metrics.averageLoadTime?.toFixed(2)}\r\n+                          ms\r\n+                        </li>\r\n+                        <li>ç½‘ç»œè¯·æ±‚: {result.metrics.networkRequests}</li>\r\n+                        <li>\r\n+                          å†…å­˜ä½¿ç”¨:{\" \"}\r\n+                          {result.metrics.memoryUsage\r\n+                            ? (\r\n+                                result.metrics.memoryUsage /\r\n+                                1024 /\r\n+                                1024\r\n+                              ).toFixed(2) + \"MB\"\r\n+                            : \"N/A\"}\r\n+                        </li>\r\n                       </ul>\r\n-                    ) : (\r\n-                      <p style={{ color: \"#28a745\" }}>âœ… æ— æ€§èƒ½é—®é¢˜</p>\r\n-                    )}\r\n-                    {result.recommendations.length > 0 && (\r\n-                      <ul style={{ fontSize: \"14px\", color: \"#007bff\" }}>\r\n-                        {result.recommendations.map((rec: string, index: number) => (\r\n-                          <li key={index}>{rec}</li>\r\n-                        ))}\r\n-                      </ul>\r\n-                    )}\r\n+                    </div>\r\n+                    <div>\r\n+                      <h5>é—®é¢˜å’Œå»ºè®®</h5>\r\n+                      {result.issues.length > 0 ? (\r\n+                        <ul style={{ fontSize: \"14px\", color: \"#dc3545\" }}>\r\n+                          {result.issues.map((issue: string, index: number) => (\r\n+                            <li key={index}>{issue}</li>\r\n+                          ))}\r\n+                        </ul>\r\n+                      ) : (\r\n+                        <p style={{ color: \"#28a745\" }}>âœ… æ— æ€§èƒ½é—®é¢˜</p>\r\n+                      )}\r\n+                      {result.recommendations.length > 0 && (\r\n+                        <ul style={{ fontSize: \"14px\", color: \"#007bff\" }}>\r\n+                          {result.recommendations.map(\r\n+                            (rec: string, index: number) => (\r\n+                              <li key={index}>{rec}</li>\r\n+                            )\r\n+                          )}\r\n+                        </ul>\r\n+                      )}\r\n+                    </div>\r\n                   </div>\r\n                 </div>\r\n-              </div>\r\n-            ))}\r\n+              )\r\n+            )}\r\n           </div>\r\n         )}\r\n       </div>\r\n \r\n       <div style={{ marginBottom: \"30px\" }}>\r\n         <h2>ä¼˜åŒ–å¯¹æ¯”æµ‹è¯•</h2>\r\n         <p>å¯¹æ¯”åŸå§‹é…ç½®å’Œä¼˜åŒ–é…ç½®çš„æ€§èƒ½å·®å¼‚ï¼š</p>\r\n \r\n-        <div style={{ display: \"grid\", gridTemplateColumns: \"1fr 1fr\", gap: \"20px\" }}>\r\n+        <div\r\n+          style={{\r\n+            display: \"grid\",\r\n+            gridTemplateColumns: \"1fr 1fr\",\r\n+            gap: \"20px\",\r\n+          }}\r\n+        >\r\n           <div>\r\n             <h4>âŒ åŸå§‹é…ç½® (é—®é¢˜)</h4>\r\n-            <div style={{ backgroundColor: \"#f8d7da\", padding: \"15px\", borderRadius: \"8px\", fontSize: \"14px\" }}>\r\n+            <div\r\n+              style={{\r\n+                backgroundColor: \"#f8d7da\",\r\n+                padding: \"15px\",\r\n+                borderRadius: \"8px\",\r\n+                fontSize: \"14px\",\r\n+              }}\r\n+            >\r\n               <ul>\r\n                 <li>200å¼ å›¾ç‰‡åŒæ—¶åŠ è½½</li>\r\n                 <li>å¤æ‚çš„ç›‘æ§å’Œåˆ†æ</li>\r\n                 <li>å¤§å°ºå¯¸ LQIP (24px)</li>\r\n@@ -208,9 +302,16 @@\n           </div>\r\n \r\n           <div>\r\n             <h4>âœ… ä¼˜åŒ–é…ç½® (æ¨è)</h4>\r\n-            <div style={{ backgroundColor: \"#d4edda\", padding: \"15px\", borderRadius: \"8px\", fontSize: \"14px\" }}>\r\n+            <div\r\n+              style={{\r\n+                backgroundColor: \"#d4edda\",\r\n+                padding: \"15px\",\r\n+                borderRadius: \"8px\",\r\n+                fontSize: \"14px\",\r\n+              }}\r\n+            >\r\n               <ul>\r\n                 <li>20-50å¼ å›¾ç‰‡åˆ†æ‰¹åŠ è½½</li>\r\n                 <li>ç®€åŒ–ç›‘æ§é…ç½®</li>\r\n                 <li>å°å°ºå¯¸ LQIP (16px)</li>\r\n@@ -226,11 +327,26 @@\n       <div style={{ marginBottom: \"30px\" }}>\r\n         <h2>å®é™…æµ‹è¯•</h2>\r\n         <p>æµ‹è¯•ä¼˜åŒ–åçš„é…ç½®ï¼š</p>\r\n \r\n-        <div ref={containerRef} style={{ display: \"grid\", gridTemplateColumns: \"repeat(auto-fit, minmax(200px, 1fr))\", gap: \"15px\" }}>\r\n+        <div\r\n+          ref={containerRef}\r\n+          style={{\r\n+            display: \"grid\",\r\n+            gridTemplateColumns: \"repeat(auto-fit, minmax(200px, 1fr))\",\r\n+            gap: \"15px\",\r\n+          }}\r\n+        >\r\n           {Array.from({ length: 20 }, (_, i) => (\r\n-            <div key={i} style={{ backgroundColor: \"white\", borderRadius: \"8px\", overflow: \"hidden\", boxShadow: \"0 2px 8px rgba(0,0,0,0.1)\" }}>\r\n+            <div\r\n+              key={i}\r\n+              style={{\r\n+                backgroundColor: \"white\",\r\n+                borderRadius: \"8px\",\r\n+                overflow: \"hidden\",\r\n+                boxShadow: \"0 2px 8px rgba(0,0,0,0.1)\",\r\n+              }}\r\n+            >\r\n               <LazyImage\r\n                 src={`https://picsum.photos/400/300?random=${i + 4000}`}\r\n                 alt={`Optimized test image ${i + 1}`}\r\n                 style={{ width: \"100%\", height: \"150px\", objectFit: \"cover\" }}\r\n@@ -250,12 +366,18 @@\n       </div>\r\n \r\n       <div style={{ marginBottom: \"30px\" }}>\r\n         <h2>ä»£ç ç¤ºä¾‹</h2>\r\n-        <div style={{ backgroundColor: \"#f8f9fa\", padding: \"20px\", borderRadius: \"8px\" }}>\r\n+        <div\r\n+          style={{\r\n+            backgroundColor: \"#f8f9fa\",\r\n+            padding: \"20px\",\r\n+            borderRadius: \"8px\",\r\n+          }}\r\n+        >\r\n           <h4>ä¼˜åŒ–åçš„é…ç½®ç¤ºä¾‹ï¼š</h4>\r\n           <pre style={{ fontSize: \"14px\", overflow: \"auto\" }}>\r\n-{`// ä¼˜åŒ–åçš„ LazyImage é…ç½®\r\n+            {`// ä¼˜åŒ–åçš„ LazyImage é…ç½®\r\n <LazyImage\r\n   src={imageSrc}\r\n   alt=\"æè¿°\"\r\n   enableLQIP={true}\r\n"
                }
            ],
            "date": 1759223181070,
            "name": "Commit-0",
            "content": "/**\r\n * è¯Šæ–­æ¼”ç¤ºé¡µé¢\r\n * ç”¨äºåˆ†æ WorkerTestDemo çš„æ€§èƒ½é—®é¢˜\r\n */\r\n\r\nimport React, { useRef, useState } from \"react\";\r\n\r\nimport { LazyImage } from \"../components/LazyImage\";\r\nimport { usePerformanceMonitor } from \"../components/LazyImage/utils/performanceAnalyzer\";\r\n\r\nconst DiagnosticDemo: React.FC = () => {\r\n  const [diagnosticResults, setDiagnosticResults] = useState<any>(null);\r\n  const [isRunning, setIsRunning] = useState(false);\r\n  const [testPhase, setTestPhase] = useState<string>(\"\");\r\n  const monitor = usePerformanceMonitor();\r\n  const containerRef = useRef<HTMLDivElement>(null);\r\n\r\n  // æµ‹è¯•é…ç½®\r\n  const testConfigs = [\r\n    { name: \"å°‘é‡å›¾ç‰‡ (5å¼ )\", count: 5, enableWorker: true },\r\n    { name: \"ä¸­ç­‰å›¾ç‰‡ (20å¼ )\", count: 20, enableWorker: true },\r\n    { name: \"å¤§é‡å›¾ç‰‡ (100å¼ )\", count: 100, enableWorker: true },\r\n    { name: \"å¤§é‡å›¾ç‰‡æ— Worker (100å¼ )\", count: 100, enableWorker: false },\r\n  ];\r\n\r\n  const runDiagnostic = async (config: typeof testConfigs[0]) => {\r\n    setIsRunning(true);\r\n    setTestPhase(`æ­£åœ¨æµ‹è¯•: ${config.name}`);\r\n    monitor.reset();\r\n\r\n    // å¼€å§‹ç»„ä»¶æŒ‚è½½è®¡æ—¶\r\n    monitor.startComponentMount();\r\n\r\n    // ç”Ÿæˆæµ‹è¯•å›¾ç‰‡\r\n    const images = Array.from({ length: config.count }, (_, i) => ({\r\n      id: i,\r\n      src: `https://picsum.photos/400/300?random=${i + 3000}`,\r\n      alt: `Diagnostic image ${i + 1}`,\r\n    }));\r\n\r\n    // æ¨¡æ‹Ÿç»„ä»¶æŒ‚è½½å®Œæˆ\r\n    setTimeout(() => {\r\n      monitor.endComponentMount();\r\n      monitor.startFirstImageLoad();\r\n    }, 100);\r\n\r\n    // è®°å½•å›¾ç‰‡åŠ è½½\r\n    let loadedCount = 0;\r\n    const handleImageLoad = () => {\r\n      loadedCount++;\r\n      if (loadedCount === 1) {\r\n        monitor.endFirstImageLoad();\r\n      }\r\n\r\n      const loadTime = Math.random() * 1000 + 500; // æ¨¡æ‹ŸåŠ è½½æ—¶é—´\r\n      monitor.recordImageLoad(loadTime);\r\n      monitor.recordNetworkRequest();\r\n\r\n      if (loadedCount === config.count) {\r\n        // æ‰€æœ‰å›¾ç‰‡åŠ è½½å®Œæˆ\r\n        setTimeout(() => {\r\n          const report = monitor.generateReport();\r\n          setDiagnosticResults((prev: any) => ({\r\n            ...prev,\r\n            [config.name]: report,\r\n          }));\r\n          setIsRunning(false);\r\n          setTestPhase(\"\");\r\n        }, 500);\r\n      }\r\n    };\r\n\r\n    return { images, handleImageLoad };\r\n  };\r\n\r\n  const runAllDiagnostics = async () => {\r\n    setDiagnosticResults({});\r\n\r\n    for (const config of testConfigs) {\r\n      const { images, handleImageLoad } = await runDiagnostic(config);\r\n\r\n      // æ¸²æŸ“æµ‹è¯•å›¾ç‰‡\r\n      setTestPhase(`æ¸²æŸ“ä¸­: ${config.name}`);\r\n\r\n      // è¿™é‡Œå¯ä»¥æ¸²æŸ“å›¾ç‰‡ç»„ä»¶ï¼Œä½†ä¸ºäº†ç®€åŒ–ï¼Œæˆ‘ä»¬ç›´æ¥æ¨¡æ‹Ÿ\r\n      setTimeout(() => {\r\n        images.forEach(() => handleImageLoad());\r\n      }, 1000);\r\n\r\n      // ç­‰å¾…å½“å‰æµ‹è¯•å®Œæˆ\r\n      await new Promise(resolve => setTimeout(resolve, 3000));\r\n    }\r\n  };\r\n\r\n  // ç§»é™¤æœªä½¿ç”¨çš„å‡½æ•°\r\n\r\n  return (\r\n    <div style={{ padding: \"20px\", maxWidth: \"1200px\", margin: \"0 auto\" }}>\r\n      <h1>LazyImage æ€§èƒ½è¯Šæ–­å·¥å…·</h1>\r\n\r\n      <div style={{ marginBottom: \"30px\" }}>\r\n        <h2>é—®é¢˜åˆ†æ</h2>\r\n        <div style={{ backgroundColor: \"#fff3cd\", padding: \"15px\", borderRadius: \"8px\", marginBottom: \"20px\" }}>\r\n          <h4>ğŸ” WorkerTestDemo é•¿æ—¶é—´ç­‰å¾…çš„å¯èƒ½åŸå› ï¼š</h4>\r\n          <ul>\r\n            <li><strong>Worker åˆå§‹åŒ–å»¶è¿Ÿ</strong> - Web Worker éœ€è¦æ—¶é—´å¯åŠ¨å’ŒåŠ è½½è„šæœ¬</li>\r\n            <li><strong>LQIP ç”Ÿæˆè€—æ—¶</strong> - æ¯å¼ å›¾ç‰‡éƒ½éœ€è¦å…ˆä¸‹è½½åŸå›¾å†ç”Ÿæˆç¼©ç•¥å›¾</li>\r\n            <li><strong>å¤§é‡å¹¶å‘è¯·æ±‚</strong> - 200å¼ å›¾ç‰‡åŒæ—¶è¯·æ±‚å¯èƒ½è§¦å‘æµè§ˆå™¨é™åˆ¶</li>\r\n            <li><strong>å¤æ‚ç›‘æ§ç³»ç»Ÿ</strong> - å¯ç”¨äº†å¤ªå¤šæ€§èƒ½åˆ†æåŠŸèƒ½</li>\r\n            <li><strong>å†…å­˜ç®¡ç†å¼€é”€</strong> - å†…å­˜ç›‘æ§å’Œæ¸…ç†æœºåˆ¶å¢åŠ å»¶è¿Ÿ</li>\r\n            <li><strong>ç½‘ç»œå»¶è¿Ÿ</strong> - picsum.photos å¯èƒ½æœ‰è¯·æ±‚é¢‘ç‡é™åˆ¶</li>\r\n          </ul>\r\n        </div>\r\n\r\n        <div style={{ backgroundColor: \"#d1ecf1\", padding: \"15px\", borderRadius: \"8px\" }}>\r\n          <h4>ğŸ’¡ ä¼˜åŒ–å»ºè®®ï¼š</h4>\r\n          <ul>\r\n            <li>âœ… <strong>å‡å°‘åˆå§‹å›¾ç‰‡æ•°é‡</strong> - ä» 200 å¼ å‡å°‘åˆ° 20-50 å¼ </li>\r\n            <li>âœ… <strong>å¯ç”¨ä¼˜å…ˆçº§åŠ è½½</strong> - ä¼˜å…ˆåŠ è½½å¯è§åŒºåŸŸçš„å›¾ç‰‡</li>\r\n            <li>âœ… <strong>ä¼˜åŒ– LQIP å‚æ•°</strong> - é™ä½è´¨é‡å’Œå°ºå¯¸ (16px, 0.5)</li>\r\n            <li>âœ… <strong>ç®€åŒ–ç›‘æ§é…ç½®</strong> - å…³é—­ä¸å¿…è¦çš„æ€§èƒ½åˆ†æ</li>\r\n            <li>âœ… <strong>ä½¿ç”¨æœ¬åœ°å›¾ç‰‡</strong> - é¿å…ç½‘ç»œè¯·æ±‚å»¶è¿Ÿ</li>\r\n            <li>âœ… <strong>é¢„åŠ è½½ Worker</strong> - æå‰åˆå§‹åŒ– Worker æ± </li>\r\n            <li>âœ… <strong>åˆ†æ‰¹åŠ è½½</strong> - ä½¿ç”¨è™šæ‹Ÿæ»šåŠ¨æˆ–åˆ†é¡µ</li>\r\n          </ul>\r\n        </div>\r\n      </div>\r\n\r\n      <div style={{ marginBottom: \"30px\" }}>\r\n        <h2>æ€§èƒ½æµ‹è¯•</h2>\r\n        <button\r\n          onClick={runAllDiagnostics}\r\n          disabled={isRunning}\r\n          style={{\r\n            padding: \"10px 20px\",\r\n            backgroundColor: isRunning ? \"#ccc\" : \"#007bff\",\r\n            color: \"white\",\r\n            border: \"none\",\r\n            borderRadius: \"4px\",\r\n            cursor: isRunning ? \"not-allowed\" : \"pointer\",\r\n            marginBottom: \"20px\",\r\n          }}\r\n        >\r\n          {isRunning ? `è¿è¡Œä¸­: ${testPhase}` : \"å¼€å§‹æ€§èƒ½è¯Šæ–­\"}\r\n        </button>\r\n\r\n        {diagnosticResults && (\r\n          <div>\r\n            <h3>è¯Šæ–­ç»“æœ</h3>\r\n            {Object.entries(diagnosticResults).map(([testName, result]: [string, any]) => (\r\n              <div key={testName} style={{ marginBottom: \"20px\", padding: \"15px\", backgroundColor: \"#f8f9fa\", borderRadius: \"8px\" }}>\r\n                <h4>{testName}</h4>\r\n                <div style={{ display: \"grid\", gridTemplateColumns: \"1fr 1fr\", gap: \"20px\" }}>\r\n                  <div>\r\n                    <h5>æ€§èƒ½æŒ‡æ ‡</h5>\r\n                    <ul style={{ fontSize: \"14px\" }}>\r\n                      <li>ç»„ä»¶æŒ‚è½½: {result.metrics.componentMountTime?.toFixed(2)}ms</li>\r\n                      <li>é¦–å›¾åŠ è½½: {result.metrics.firstImageLoadTime?.toFixed(2)}ms</li>\r\n                      <li>Worker åˆå§‹åŒ–: {result.metrics.workerInitTime?.toFixed(2)}ms</li>\r\n                      <li>å¹³å‡åŠ è½½: {result.metrics.averageLoadTime?.toFixed(2)}ms</li>\r\n                      <li>ç½‘ç»œè¯·æ±‚: {result.metrics.networkRequests}</li>\r\n                      <li>å†…å­˜ä½¿ç”¨: {result.metrics.memoryUsage ? (result.metrics.memoryUsage / 1024 / 1024).toFixed(2) + \"MB\" : \"N/A\"}</li>\r\n                    </ul>\r\n                  </div>\r\n                  <div>\r\n                    <h5>é—®é¢˜å’Œå»ºè®®</h5>\r\n                    {result.issues.length > 0 ? (\r\n                      <ul style={{ fontSize: \"14px\", color: \"#dc3545\" }}>\r\n                        {result.issues.map((issue: string, index: number) => (\r\n                          <li key={index}>{issue}</li>\r\n                        ))}\r\n                      </ul>\r\n                    ) : (\r\n                      <p style={{ color: \"#28a745\" }}>âœ… æ— æ€§èƒ½é—®é¢˜</p>\r\n                    )}\r\n                    {result.recommendations.length > 0 && (\r\n                      <ul style={{ fontSize: \"14px\", color: \"#007bff\" }}>\r\n                        {result.recommendations.map((rec: string, index: number) => (\r\n                          <li key={index}>{rec}</li>\r\n                        ))}\r\n                      </ul>\r\n                    )}\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            ))}\r\n          </div>\r\n        )}\r\n      </div>\r\n\r\n      <div style={{ marginBottom: \"30px\" }}>\r\n        <h2>ä¼˜åŒ–å¯¹æ¯”æµ‹è¯•</h2>\r\n        <p>å¯¹æ¯”åŸå§‹é…ç½®å’Œä¼˜åŒ–é…ç½®çš„æ€§èƒ½å·®å¼‚ï¼š</p>\r\n\r\n        <div style={{ display: \"grid\", gridTemplateColumns: \"1fr 1fr\", gap: \"20px\" }}>\r\n          <div>\r\n            <h4>âŒ åŸå§‹é…ç½® (é—®é¢˜)</h4>\r\n            <div style={{ backgroundColor: \"#f8d7da\", padding: \"15px\", borderRadius: \"8px\", fontSize: \"14px\" }}>\r\n              <ul>\r\n                <li>200å¼ å›¾ç‰‡åŒæ—¶åŠ è½½</li>\r\n                <li>å¤æ‚çš„ç›‘æ§å’Œåˆ†æ</li>\r\n                <li>å¤§å°ºå¯¸ LQIP (24px)</li>\r\n                <li>é«˜å†…å­˜é™åˆ¶ (120MB)</li>\r\n                <li>é•¿å¸è½½å»¶è¿Ÿ (4000ms)</li>\r\n                <li>æ‰€æœ‰åŠŸèƒ½å…¨å¼€</li>\r\n              </ul>\r\n            </div>\r\n          </div>\r\n\r\n          <div>\r\n            <h4>âœ… ä¼˜åŒ–é…ç½® (æ¨è)</h4>\r\n            <div style={{ backgroundColor: \"#d4edda\", padding: \"15px\", borderRadius: \"8px\", fontSize: \"14px\" }}>\r\n              <ul>\r\n                <li>20-50å¼ å›¾ç‰‡åˆ†æ‰¹åŠ è½½</li>\r\n                <li>ç®€åŒ–ç›‘æ§é…ç½®</li>\r\n                <li>å°å°ºå¯¸ LQIP (16px)</li>\r\n                <li>é€‚ä¸­å†…å­˜é™åˆ¶ (50MB)</li>\r\n                <li>çŸ­å¸è½½å»¶è¿Ÿ (2000ms)</li>\r\n                <li>æŒ‰éœ€å¯ç”¨åŠŸèƒ½</li>\r\n              </ul>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      <div style={{ marginBottom: \"30px\" }}>\r\n        <h2>å®é™…æµ‹è¯•</h2>\r\n        <p>æµ‹è¯•ä¼˜åŒ–åçš„é…ç½®ï¼š</p>\r\n\r\n        <div ref={containerRef} style={{ display: \"grid\", gridTemplateColumns: \"repeat(auto-fit, minmax(200px, 1fr))\", gap: \"15px\" }}>\r\n          {Array.from({ length: 20 }, (_, i) => (\r\n            <div key={i} style={{ backgroundColor: \"white\", borderRadius: \"8px\", overflow: \"hidden\", boxShadow: \"0 2px 8px rgba(0,0,0,0.1)\" }}>\r\n              <LazyImage\r\n                src={`https://picsum.photos/400/300?random=${i + 4000}`}\r\n                alt={`Optimized test image ${i + 1}`}\r\n                style={{ width: \"100%\", height: \"150px\", objectFit: \"cover\" }}\r\n                enableLQIP={true}\r\n                lqipWidth={16}\r\n                lqipQuality={0.5}\r\n                enableLQIPWorker={true}\r\n                showLoadingIndicator={true}\r\n                priority={i < 6 ? \"high\" : \"medium\"}\r\n                onLoad={() => {\r\n                  console.log(`Image ${i + 1} loaded`);\r\n                }}\r\n              />\r\n            </div>\r\n          ))}\r\n        </div>\r\n      </div>\r\n\r\n      <div style={{ marginBottom: \"30px\" }}>\r\n        <h2>ä»£ç ç¤ºä¾‹</h2>\r\n        <div style={{ backgroundColor: \"#f8f9fa\", padding: \"20px\", borderRadius: \"8px\" }}>\r\n          <h4>ä¼˜åŒ–åçš„é…ç½®ç¤ºä¾‹ï¼š</h4>\r\n          <pre style={{ fontSize: \"14px\", overflow: \"auto\" }}>\r\n{`// ä¼˜åŒ–åçš„ LazyImage é…ç½®\r\n<LazyImage\r\n  src={imageSrc}\r\n  alt=\"æè¿°\"\r\n  enableLQIP={true}\r\n  lqipWidth={16}           // å‡å°å°ºå¯¸\r\n  lqipQuality={0.5}        // é™ä½è´¨é‡\r\n  enableLQIPWorker={true}\r\n  showLoadingIndicator={true}\r\n  priority=\"high\"          // é¦–å±å›¾ç‰‡é«˜ä¼˜å…ˆçº§\r\n  rootMargin=\"100px\"       // é€‚ä¸­çš„é¢„åŠ è½½è·ç¦»\r\n  threshold={0.1}\r\n  enableCache={true}\r\n  retryCount={2}           // å‡å°‘é‡è¯•æ¬¡æ•°\r\n/>\r\n\r\n// ç®€åŒ–åçš„ Hook é…ç½®\r\nconst imageCache = useEnhancedImageCache({\r\n  maxBytes: 50 * 1024 * 1024,  // å‡å°‘ç¼“å­˜å¤§å°\r\n  enableHitRateTracking: false, // å…³é—­å¤æ‚åˆ†æ\r\n  enableSizeDistributionAnalysis: false,\r\n  enableCleanupHistory: false,\r\n  enableIndexedDBMonitoring: false,\r\n  enablePerformanceMetrics: false,\r\n});\r\n\r\nconst memoryManager = useEnhancedMemoryManager({\r\n  maxMemoryUsage: 50 * 1024 * 1024,  // å‡å°‘å†…å­˜é™åˆ¶\r\n  unloadDistance: 1000,               // å‡å°‘å¸è½½è·ç¦»\r\n  unloadDelay: 2000,                  // å‡å°‘å¸è½½å»¶è¿Ÿ\r\n  enableLifecycleTracking: false,     // å…³é—­å¤æ‚è¿½è¸ª\r\n  enableLeakDetection: false,\r\n  enableTrendAnalysis: false,\r\n});`}\r\n          </pre>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default DiagnosticDemo;\r\n"
        }
    ]
}